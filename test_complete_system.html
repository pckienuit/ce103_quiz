<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎯 Complete System Test - CE103 Quiz with Gemini AI</title>
    <link rel="stylesheet" href="css/quiz_bright.css">
    <!-- Prism.js for code highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <!-- MathJax for mathematical formulas -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };
    </script>
</head>
<body>
    <div class="quiz-container">
        <h1>🎯 Complete System Test</h1>
        <div id="ai-status" class="ai-status">Initializing...</div>
        
        <div style="margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 8px;">
            <h2>🤖 Gemini AI Integration Test</h2>
            <p><strong>Status:</strong> <span id="gemini-status">Testing...</span></p>
            <p><strong>Model:</strong> gemini-2.5-flash-preview-05-20</p>
            <p><strong>API Endpoint:</strong> api/gemini_analyzer.php</p>
            
            <div style="margin: 15px 0;">
                <h4>Test Input:</h4>
                <div style="background: #fff; padding: 10px; border-radius: 4px; border: 1px solid #dee2e6;">
                    Vi điều khiển 8051 sử dụng lệnh MOV A, #20H để nạp giá trị 20H vào thanh ghi ACC. Chỉ thị JMP 4000H thực hiện nhảy đến địa chỉ 4000H trong bộ nhớ ROM. Công thức tính toán: $f(x) = ax^2 + bx + c$
                </div>
            </div>
            
            <div style="margin: 15px 0;">
                <h4>Gemini AI Analysis Result:</h4>
                <div id="ai-result" style="background: #d4edda; padding: 10px; border-radius: 4px; border: 1px solid #c3e6cb; min-height: 50px;">
                    Analyzing...
                </div>
            </div>
            
            <button onclick="testGeminiAI()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">🔄 Test Gemini AI</button>
        </div>

        <div style="margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); border-radius: 8px;">
            <h2>🎨 Bright Theme Features</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h4>Assembly Code</h4>
                    <code class="inline-code-bright">MOV A, #20H</code><br>
                    <code class="inline-code-bright">JMP 4000H</code>
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h4>Technical Terms</h4>
                    <span class="tech-term">ROM</span>
                    <span class="tech-term">RAM</span>
                    <span class="tech-term">CPU</span>
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h4>Numbers</h4>
                    <span class="number-highlight">0xFF</span>
                    <span class="number-highlight">4000H</span>
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h4>Math Formula</h4>
                    $f(x) = ax^2 + bx + c$
                </div>
            </div>
        </div>

        <div style="margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%); border-radius: 8px;">
            <h2>📊 Feature Checklist</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 10px;">
                <div>✅ Gemini AI Integration</div>
                <div>✅ Bright Theme Design</div>
                <div>✅ Assembly Code Highlighting</div>
                <div>✅ Mathematical Formula Support</div>
                <div>✅ False Positive Prevention</div>
                <div>✅ Vietnamese Language Support</div>
                <div>✅ 230 Quiz Questions</div>
                <div>✅ 60 Specialized Flashcards</div>
                <div>✅ Exit Button with Confirmation</div>
                <div>✅ Responsive Design</div>
                <div>✅ Performance Optimization</div>
                <div>✅ Error Handling</div>
            </div>
        </div>

        <div style="margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); border-radius: 8px;">
            <h2>🚀 Quick Navigation</h2>
            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                <a href="index.html" style="padding: 10px 20px; background: #28a745; color: white; text-decoration: none; border-radius: 4px;">🏠 Trang chủ</a>
                <a href="quiz.html" style="padding: 10px 20px; background: #007bff; color: white; text-decoration: none; border-radius: 4px;">📝 Quiz Application</a>
                <a href="flashcards.html" style="padding: 10px 20px; background: #17a2b8; color: white; text-decoration: none; border-radius: 4px;">📚 Flashcards</a>
                <a href="test_gemini_ai.html" style="padding: 10px 20px; background: #6f42c1; color: white; text-decoration: none; border-radius: 4px;">🤖 Gemini AI Test</a>
                <a href="test_improved_highlighting.html" style="padding: 10px 20px; background: #fd7e14; color: white; text-decoration: none; border-radius: 4px;">🎨 Highlighting Test</a>
            </div>
        </div>

        <div style="margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%); border-radius: 8px;">
            <h2>📈 Performance Metrics</h2>
            <div id="performance-metrics" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                <div style="background: white; padding: 10px; border-radius: 4px; text-align: center;">
                    <div style="font-size: 2em; color: #28a745;">230</div>
                    <div>Quiz Questions</div>
                </div>
                <div style="background: white; padding: 10px; border-radius: 4px; text-align: center;">
                    <div style="font-size: 2em; color: #007bff;">60</div>
                    <div>Flashcards</div>
                </div>
                <div style="background: white; padding: 10px; border-radius: 4px; text-align: center;">
                    <div style="font-size: 2em; color: #6f42c1;" id="ai-response-time">-</div>
                    <div>AI Response (ms)</div>
                </div>
                <div style="background: white; padding: 10px; border-radius: 4px; text-align: center;">
                    <div style="font-size: 2em; color: #fd7e14;" id="cache-size">-</div>
                    <div>Cache Items</div>
                </div>
            </div>
        </div>

        <div style="text-align: center; margin: 30px 0; padding: 20px; background: linear-gradient(135deg, #6f42c1 0%, #495057 100%); color: white; border-radius: 8px;">
            <h2>🎯 Project Status: COMPLETE ✅</h2>
            <p style="font-size: 1.1em; margin: 10px 0;">
                <strong>CE103 Quiz Application với Gemini AI Integration</strong><br>
                Hoàn thành với đầy đủ tính năng AI-powered highlighting, bright theme design, và comprehensive educational content.
            </p>
            <p style="margin: 15px 0;">
                <strong>Ready for Production Deployment! 🚀</strong>
            </p>
        </div>
    </div>

    <script src="js/gemini_highlighter.js"></script>
    <script>
        let testStartTime;

        function updateStatus(message, type = 'active') {
            const statusEl = document.getElementById('ai-status');
            statusEl.textContent = message;
            statusEl.className = `ai-status ${type}`;
        }

        async function testGeminiAI() {
            const testText = "Vi điều khiển 8051 sử dụng lệnh MOV A, #20H để nạp giá trị 20H vào thanh ghi ACC. Chỉ thị JMP 4000H thực hiện nhảy đến địa chỉ 4000H trong bộ nhớ ROM. Công thức tính toán: $f(x) = ax^2 + bx + c$";
            
            updateStatus('🤖 Testing Gemini AI...', 'active');
            document.getElementById('gemini-status').textContent = 'Processing...';
            testStartTime = Date.now();

            try {
                const result = await geminiHighlighter.analyzeText(testText);
                const responseTime = Date.now() - testStartTime;
                
                document.getElementById('ai-result').innerHTML = result;
                document.getElementById('gemini-status').innerHTML = '<span style="color: green;">✅ SUCCESS</span>';
                document.getElementById('ai-response-time').textContent = responseTime;
                
                // Get cache stats
                const cacheStats = geminiHighlighter.getCacheStats();
                document.getElementById('cache-size').textContent = cacheStats.size;
                
                updateStatus('✅ AI Test Complete', 'active');

                // Render with Prism and MathJax
                if (window.Prism) {
                    Prism.highlightAllUnder(document.getElementById('ai-result'));
                }
                if (window.MathJax) {
                    MathJax.typesetPromise([document.getElementById('ai-result')]);
                }

            } catch (error) {
                console.error('Gemini test failed:', error);
                document.getElementById('ai-result').innerHTML = `<span style="color: red;">❌ Error: ${error.message}</span>`;
                document.getElementById('gemini-status').innerHTML = '<span style="color: red;">❌ FAILED</span>';
                updateStatus('❌ AI Test Failed', 'error');
            }
        }

        // Auto-test on load
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                if (window.geminiHighlighter) {
                    updateStatus('🤖 Gemini AI Ready', 'active');
                    // Auto-run test
                    testGeminiAI();
                } else {
                    updateStatus('❌ Gemini AI Not Available', 'error');
                    document.getElementById('gemini-status').innerHTML = '<span style="color: red;">❌ NOT AVAILABLE</span>';
                }
            }, 1500);
        });
    </script>
</body>
</html>
