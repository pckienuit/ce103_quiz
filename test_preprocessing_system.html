<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Test Enhanced Highlighting System</title>
    <link rel="stylesheet" href="css/quiz_bright.css">
    <!-- Prism.js for code highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <!-- MathJax for mathematical formulas -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };
    </script>
</head>
<body>
    <div class="quiz-container">
        <h1>üß™ Test Enhanced Highlighting System</h1>
        
        <div id="ai-status" class="ai-status">üîÑ Initializing...</div>
        
        <div style="margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">
            <h3>Test Text Samples:</h3>
            
            <div style="margin: 10px 0;">
                <strong>Sample 1 (Assembly):</strong>
                <div id="test1">MOV A, #0xFF; JMP 2000H; ADD A, R0</div>
            </div>
            
            <div style="margin: 10px 0;">
                <strong>Sample 2 (Technical Terms):</strong>
                <div id="test2">CPU x·ª≠ l√Ω d·ªØ li·ªáu t·ª´ RAM v√† ROM th√¥ng qua UART</div>
            </div>
            
            <div style="margin: 10px 0;">
                <strong>Sample 3 (Numbers):</strong>
                <div id="test3">ƒê·ªãa ch·ªâ 0xFF00 trong ROM ch·ª©a gi√° tr·ªã 1010B</div>
            </div>
            
            <div style="margin: 10px 0;">
                <strong>Sample 4 (Math Formula):</strong>
                <div id="test4">T√≠nh to√°n: $f(x) = x^2 + 2x + 1$ v√† $$\sum_{i=1}^{n} i = \frac{n(n+1)}{2}$$</div>
            </div>
        </div>
        
        <div style="margin: 20px 0;">
            <button onclick="testEnhancedHighlighter()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                üß™ Test Enhanced Highlighting
            </button>
            <button onclick="testFallbackHighlighting()" style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">
                üîß Test Fallback Highlighting
            </button>
        </div>
        
        <div id="result" style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <strong>Results will appear here...</strong>
        </div>
        
        <div style="margin: 20px 0;">
            <a href="quiz.html" style="padding: 10px 20px; background: #6c757d; color: white; text-decoration: none; border-radius: 4px; margin-right: 10px;">Go to Quiz</a>
            <a href="flashcards.html" style="padding: 10px 20px; background: #6c757d; color: white; text-decoration: none; border-radius: 4px; margin-right: 10px;">Go to Flashcards</a>
            <a href="index.html" style="padding: 10px 20px; background: #6c757d; color: white; text-decoration: none; border-radius: 4px;">Back to Home</a>
        </div>
    </div>

    <script src="js/enhanced_highlighter.js"></script>
    <script>
        function updateStatus(message, type = 'active') {
            const statusEl = document.getElementById('ai-status');
            if (statusEl) {
                statusEl.textContent = message;
                statusEl.className = `ai-status ${type}`;
            }
        }

        async function testEnhancedHighlighter() {
            updateStatus('üîÑ Testing enhanced highlighting...', 'active');
            const resultDiv = document.getElementById('result');
            
            try {
                if (!window.enhancedHighlighter) {
                    throw new Error('Enhanced highlighter not available');
                }
                
                // Try to load enhanced data
                try {
                    await window.enhancedHighlighter.loadEnhancedData();
                    updateStatus('‚úÖ Enhanced data loaded successfully!', 'active');
                    resultDiv.innerHTML = `
                        <h4>‚úÖ Enhanced Highlighting Test Successful!</h4>
                        <p>‚úì Enhanced highlighter loaded</p>
                        <p>‚úì Enhanced JSON data available</p>
                        <p>‚úì Ready for AI-powered highlighting</p>
                        <p><strong>Questions available:</strong> ${window.enhancedHighlighter.enhancedQuestions?.length || 'N/A'}</p>
                        <p><strong>Flashcards available:</strong> ${window.enhancedHighlighter.enhancedFlashcards?.length || 'N/A'}</p>
                    `;
                } catch (enhancedError) {
                    updateStatus('‚ö†Ô∏è Enhanced data unavailable, testing fallback', 'fallback');
                    resultDiv.innerHTML = `
                        <h4>‚ö†Ô∏è Enhanced Data Not Available</h4>
                        <p>‚ùå Enhanced JSON files not found</p>
                        <p>üí° This is expected if preprocessing hasn't completed yet</p>
                        <p><strong>Error:</strong> ${enhancedError.message}</p>
                        <p><strong>Solution:</strong> Run the Python preprocessing script first</p>
                    `;
                }
            } catch (error) {
                updateStatus('‚ùå Test failed', 'error');
                resultDiv.innerHTML = `
                    <h4>‚ùå Test Failed</h4>
                    <p><strong>Error:</strong> ${error.message}</p>
                `;
            }
        }

        async function testFallbackHighlighting() {
            updateStatus('üîß Testing fallback highlighting...', 'fallback');
            const resultDiv = document.getElementById('result');
            
            try {
                if (!window.enhancedHighlighter) {
                    throw new Error('Enhanced highlighter not available');
                }
                
                // Test fallback highlighting
                const testTexts = [
                    'MOV A, #0xFF; JMP 2000H; ADD A, R0',
                    'CPU x·ª≠ l√Ω d·ªØ li·ªáu t·ª´ RAM v√† ROM th√¥ng qua UART',
                    'ƒê·ªãa ch·ªâ 0xFF00 trong ROM ch·ª©a gi√° tr·ªã 1010B'
                ];
                
                let results = '';
                testTexts.forEach((text, index) => {
                    const highlighted = window.enhancedHighlighter.fallbackHighlight(text);
                    results += `
                        <div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                            <strong>Test ${index + 1}:</strong><br>
                            <strong>Original:</strong> ${text}<br>
                            <strong>Highlighted:</strong> ${highlighted}
                        </div>
                    `;
                });
                
                updateStatus('‚úÖ Fallback highlighting working', 'fallback');
                resultDiv.innerHTML = `
                    <h4>üîß Fallback Highlighting Test Results</h4>
                    <p>‚úì Fallback highlighting system working</p>
                    <p>‚úì Regex patterns applied successfully</p>
                    ${results}
                `;
                
                // Apply highlighting to test divs
                document.getElementById('test1').innerHTML = window.enhancedHighlighter.fallbackHighlight(document.getElementById('test1').textContent);
                document.getElementById('test2').innerHTML = window.enhancedHighlighter.fallbackHighlight(document.getElementById('test2').textContent);
                document.getElementById('test3').innerHTML = window.enhancedHighlighter.fallbackHighlight(document.getElementById('test3').textContent);
                
                // Trigger MathJax
                if (window.MathJax) {
                    MathJax.typesetPromise([document.getElementById('test4')]).catch(function (err) {
                        console.log('MathJax error: ' + err.message);
                    });
                }
                
            } catch (error) {
                updateStatus('‚ùå Fallback test failed', 'error');
                resultDiv.innerHTML = `
                    <h4>‚ùå Fallback Test Failed</h4>
                    <p><strong>Error:</strong> ${error.message}</p>
                `;
            }
        }

        // Auto-test on load
        document.addEventListener('DOMContentLoaded', async () => {
            updateStatus('üöÄ System initialized', 'active');
            
            // Wait a bit then auto-test
            setTimeout(async () => {
                await testEnhancedHighlighter();
            }, 1000);
        });
    </script>
</body>
</html>
